<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Gallery of Meow</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <header>
      <div class="mono">Issue No. 001</div>
      <div class="mono">Est. 2025</div>
    </header>

    <main>
      <h1 class="hero-text">PURR<br>SPECTIVE</h1>

      <section class="status-panel mono">
        <div>Treats: <span id="treat-count">0</span></div>
        <div>Laser Best: <span id="laser-best">0</span></div>
        <div>Album: <span id="sticker-progress">0%</span></div>
      </section>

      <div class="cat-container" id="hero-cat" role="button" tabindex="0" aria-label="Pet the cat">
        <div class="speech-bubble" id="speech">pet me</div>
        <div class="cat-kaomoji" id="kaomoji">/ᐠ｡ꞈ｡ᐟ\</div>
      </div>

      <section class="control-row">
        <button id="fortune-btn" class="mono">Consult Oracle Cat</button>
        <button id="laser-btn" class="mono">Start Laser Dash (5s)</button>
        <button id="chaos-btn" class="mono" aria-pressed="false">Chaos Mode: Off</button>
      </section>

      <div id="fortune-box" class="fortune-box mono">
        The oracle cat waits for your question.
      </div>

      <section class="laser-game">
        <div class="laser-head mono">
          <span id="laser-status">Ready for laser dash.</span>
          <span id="laser-score">Score: 0</span>
          <span id="laser-time">Time: 5.0s</span>
        </div>
        <div id="laser-arena" class="laser-arena" aria-label="Laser dot arena">
          <div id="laser-dot" class="laser-dot" hidden></div>
        </div>
      </section>

      <section class="gallery" id="sticker-gallery">
        <article class="gallery-item" data-sticker="stoic">
          <div class="item-kaomoji">^._.^</div>
          <div class="item-title">THE STOIC</div>
          <div class="item-hint">Starter sticker</div>
        </article>
        <article class="gallery-item" data-sticker="greeting">
          <div class="item-kaomoji">(=^･ω･^=)</div>
          <div class="item-title">THE GREETING</div>
          <div class="item-hint">Unlock: 10 treats</div>
        </article>
        <article class="gallery-item" data-sticker="anger">
          <div class="item-kaomoji">(=｀ω´=)</div>
          <div class="item-title">THE ANGER</div>
          <div class="item-hint">Unlock: 25 treats</div>
        </article>
        <article class="gallery-item" data-sticker="doze">
          <div class="item-kaomoji">/ᐠ_ ꞈ _ᐟ\</div>
          <div class="item-title">THE DOZE</div>
          <div class="item-hint">Unlock: 50 treats</div>
        </article>
        <article class="gallery-item" data-sticker="oracle">
          <div class="item-kaomoji">(=^･ｪ･^=)</div>
          <div class="item-title">THE ORACLE</div>
          <div class="item-hint">Unlock: ask for a fortune</div>
        </article>
        <article class="gallery-item" data-sticker="laser">
          <div class="item-kaomoji">●</div>
          <div class="item-title">THE CHASER</div>
          <div class="item-hint">Unlock: score 6 in Laser Dash</div>
        </article>
        <article class="gallery-item" data-sticker="chaos">
          <div class="item-kaomoji">(ﾉ◕ヮ◕)ﾉ*:･ﾟ✧</div>
          <div class="item-title">THE CHAOS</div>
          <div class="item-hint">Unlock: toggle Chaos Mode</div>
        </article>
        <article class="gallery-item" data-sticker="secret">
          <div class="item-kaomoji">(=ↀωↀ=)</div>
          <div class="item-title">THE SECRET</div>
          <div class="item-hint">Unlock: hidden keyboard ritual</div>
        </article>
      </section>

      <div id="secret-banner" class="secret-banner" hidden></div>
      <div id="neon-cat" class="neon-cat" hidden>(^ↀᴥↀ^)</div>
    </main>

    <footer>
      <div>DESIGNED FOR CATS</div>
      <div id="coords">X: 0 Y: 0</div>
    </footer>
  </div>

  <script>
    (() => {
      const storageKey = "gallery-of-meow-state-v2";
      const totalStickers = 8;

      const defaultState = {
        treats: 0,
        laserBest: 0,
        chaos: false,
        stickers: {
          stoic: true,
          greeting: false,
          anger: false,
          doze: false,
          oracle: false,
          laser: false,
          chaos: false,
          secret: false
        },
        secretsFound: {
          meow: false,
          konami: false
        }
      };

      const moodDeck = [
        { face: "/ᐠ｡ꞈ｡ᐟ\\", msg: "purr...", unlockAt: 0 },
        { face: "(=^ ◡ ^=)", msg: "happy!", unlockAt: 0 },
        { face: "ฅ^•ﻌ•^ฅ", msg: "feed me", unlockAt: 0 },
        { face: "(=｀ω´=)", msg: "hiss!", unlockAt: 25 },
        { face: "/ᐠ_ ꞈ _ᐟ\\", msg: "dozing...", unlockAt: 50 },
        { face: "(ﾉ◕ヮ◕)ﾉ*:･ﾟ✧", msg: "zoomies!", unlockAt: 10 }
      ];

      const fortunes = [
        "You will find exactly one warm sunbeam and claim it.",
        "A cardboard box approaches. Greatness follows.",
        "The next snack appears when you sit dramatically.",
        "Today is excellent for strategic naps.",
        "A mysterious toe will pass nearby. You know what to do.",
        "An unopened package brings fortune and shredded paper.",
        "Your zoomies will be remembered for generations.",
        "The red dot fears your focus.",
        "A polite meow yields unreasonable rewards.",
        "Someone will call you baby in the next hour."
      ];

      const konami = [
        "ArrowUp",
        "ArrowUp",
        "ArrowDown",
        "ArrowDown",
        "ArrowLeft",
        "ArrowRight",
        "ArrowLeft",
        "ArrowRight",
        "b",
        "a"
      ];

      const kaomoji = document.getElementById("kaomoji");
      const speech = document.getElementById("speech");
      const coords = document.getElementById("coords");
      const heroCat = document.getElementById("hero-cat");
      const treatCount = document.getElementById("treat-count");
      const laserBest = document.getElementById("laser-best");
      const stickerProgress = document.getElementById("sticker-progress");
      const stickerGallery = document.getElementById("sticker-gallery");
      const fortuneBtn = document.getElementById("fortune-btn");
      const laserBtn = document.getElementById("laser-btn");
      const chaosBtn = document.getElementById("chaos-btn");
      const fortuneBox = document.getElementById("fortune-box");
      const laserArena = document.getElementById("laser-arena");
      const laserDot = document.getElementById("laser-dot");
      const laserStatus = document.getElementById("laser-status");
      const laserScore = document.getElementById("laser-score");
      const laserTime = document.getElementById("laser-time");
      const secretBanner = document.getElementById("secret-banner");
      const neonCat = document.getElementById("neon-cat");

      const state = loadState();

      const laserGame = {
        running: false,
        score: 0,
        startAt: 0,
        moveInterval: null,
        tickInterval: null
      };

      let typedBuffer = "";
      let konamiIndex = 0;
      let secretTimeout = null;
      const cloneDefaultState = () => JSON.parse(JSON.stringify(defaultState));

      function loadState() {
        try {
          const raw = localStorage.getItem(storageKey);
          if (!raw) {
            return cloneDefaultState();
          }
          const parsed = JSON.parse(raw);
          return {
            ...cloneDefaultState(),
            ...parsed,
            stickers: {
              ...defaultState.stickers,
              ...(parsed.stickers || {})
            },
            secretsFound: {
              ...defaultState.secretsFound,
              ...(parsed.secretsFound || {})
            }
          };
        } catch (error) {
          console.warn("state reset", error);
          return cloneDefaultState();
        }
      }

      function saveState() {
        localStorage.setItem(storageKey, JSON.stringify(state));
      }

      function randomFrom(list) {
        return list[Math.floor(Math.random() * list.length)];
      }

      function availableMoods() {
        return moodDeck.filter((mood) => state.treats >= mood.unlockAt);
      }

      function unlockSticker(id, message) {
        if (state.stickers[id]) {
          return;
        }
        state.stickers[id] = true;
        if (message) {
          speech.textContent = message;
        }
      }

      function checkMilestones() {
        if (state.treats >= 10) {
          unlockSticker("greeting", "10 treats! Greeting unlocked.");
        }
        if (state.treats >= 25) {
          unlockSticker("anger", "25 treats! Anger unlocked.");
        }
        if (state.treats >= 50) {
          unlockSticker("doze", "50 treats! Doze unlocked.");
        }
      }

      function updateStickerGallery() {
        const cards = stickerGallery.querySelectorAll(".gallery-item");
        cards.forEach((card) => {
          const id = card.dataset.sticker;
          const unlocked = Boolean(state.stickers[id]);
          card.classList.toggle("locked", !unlocked);
          card.setAttribute("aria-disabled", unlocked ? "false" : "true");
        });
      }

      function updateHud() {
        treatCount.textContent = String(state.treats);
        laserBest.textContent = String(state.laserBest);

        const unlocked = Object.values(state.stickers).filter(Boolean).length;
        stickerProgress.textContent = `${Math.round((unlocked / totalStickers) * 100)}%`;

        document.body.classList.toggle("chaos-mode", state.chaos);
        chaosBtn.setAttribute("aria-pressed", state.chaos ? "true" : "false");
        chaosBtn.textContent = state.chaos ? "Chaos Mode: On" : "Chaos Mode: Off";
      }

      function render() {
        checkMilestones();
        updateHud();
        updateStickerGallery();
      }

      function petCat() {
        state.treats += 1;
        const mood = randomFrom(availableMoods());
        kaomoji.textContent = mood.face;
        speech.textContent = mood.msg;
        kaomoji.style.transform = "scale(0.93) rotate(4deg)";
        setTimeout(() => {
          kaomoji.style.transform = "";
        }, 140);
        render();
        saveState();
      }

      function readFortune() {
        const fortune = randomFrom(fortunes);
        fortuneBox.textContent = fortune;
        speech.textContent = "the oracle has spoken";
        unlockSticker("oracle", "Oracle sticker unlocked.");
        render();
        saveState();
      }

      function placeLaserDot() {
        const arenaRect = laserArena.getBoundingClientRect();
        const dotSize = 24;
        const maxX = Math.max(0, arenaRect.width - dotSize);
        const maxY = Math.max(0, arenaRect.height - dotSize);
        const x = Math.round(Math.random() * maxX);
        const y = Math.round(Math.random() * maxY);
        laserDot.style.left = `${x}px`;
        laserDot.style.top = `${y}px`;
      }

      function setLaserReadout(score, secondsLeft) {
        laserScore.textContent = `Score: ${score}`;
        laserTime.textContent = `Time: ${secondsLeft.toFixed(1)}s`;
      }

      function endLaserGame() {
        if (!laserGame.running) {
          return;
        }
        laserGame.running = false;
        clearInterval(laserGame.moveInterval);
        clearInterval(laserGame.tickInterval);
        laserGame.moveInterval = null;
        laserGame.tickInterval = null;
        laserDot.hidden = true;
        laserBtn.disabled = false;
        setLaserReadout(laserGame.score, 0);

        if (laserGame.score > state.laserBest) {
          state.laserBest = laserGame.score;
        }

        if (laserGame.score >= 6) {
          laserStatus.textContent = "Laser mastered. Sticker unlocked.";
          speech.textContent = "you caught the dot!";
          unlockSticker("laser", "Laser sticker unlocked.");
        } else {
          laserStatus.textContent = "Dot escaped. Try for score 6.";
          speech.textContent = "so close...";
        }

        render();
        saveState();
      }

      function startLaserGame() {
        if (laserGame.running) {
          return;
        }
        laserGame.running = true;
        laserGame.score = 0;
        laserGame.startAt = performance.now();
        laserBtn.disabled = true;
        laserDot.hidden = false;
        laserStatus.textContent = "Catch the red dot.";
        setLaserReadout(0, 5);
        placeLaserDot();

        laserGame.moveInterval = setInterval(placeLaserDot, 550);
        laserGame.tickInterval = setInterval(() => {
          const elapsed = (performance.now() - laserGame.startAt) / 1000;
          const left = Math.max(0, 5 - elapsed);
          setLaserReadout(laserGame.score, left);
          if (left <= 0) {
            endLaserGame();
          }
        }, 40);
      }

      function triggerSecretBanner(text) {
        if (secretTimeout) {
          clearTimeout(secretTimeout);
        }
        secretBanner.textContent = text;
        secretBanner.hidden = false;
        neonCat.hidden = false;
        secretTimeout = setTimeout(() => {
          secretBanner.hidden = true;
          neonCat.hidden = true;
        }, 2300);
      }

      function unlockSecret(type, message) {
        if (!state.secretsFound[type]) {
          state.secretsFound[type] = true;
          triggerSecretBanner(message);
        }
        if (Object.values(state.secretsFound).some(Boolean)) {
          unlockSticker("secret", "Secret sticker unlocked.");
        }
        render();
        saveState();
      }

      heroCat.addEventListener("click", petCat);
      heroCat.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          petCat();
        }
      });

      fortuneBtn.addEventListener("click", readFortune);
      laserBtn.addEventListener("click", startLaserGame);
      chaosBtn.addEventListener("click", () => {
        state.chaos = !state.chaos;
        if (state.chaos) {
          unlockSticker("chaos", "Chaos sticker unlocked.");
          speech.textContent = "maximum chaos";
        } else {
          speech.textContent = "calm restored";
        }
        render();
        saveState();
      });

      laserDot.addEventListener("pointerenter", () => {
        if (!laserGame.running) {
          return;
        }
        laserGame.score += 1;
        setLaserReadout(laserGame.score, Math.max(0, 5 - (performance.now() - laserGame.startAt) / 1000));
        placeLaserDot();
      });

      document.addEventListener("mousemove", (event) => {
        coords.textContent = `X: ${event.clientX} Y: ${event.clientY}`;
        const x = (window.innerWidth - event.pageX * 2) / 100;
        const y = (window.innerHeight - event.pageY * 2) / 100;
        heroCat.style.transform = `translate(${x}px, ${y}px)`;
      });

      document.addEventListener("keydown", (event) => {
        const key = event.key;
        if (key.length === 1) {
          typedBuffer = (typedBuffer + key.toLowerCase()).slice(-12);
          if (typedBuffer.includes("meow")) {
            typedBuffer = "";
            unlockSecret("meow", "Secret phrase accepted.");
          }
        }

        if (key.toLowerCase() === konami[konamiIndex].toLowerCase()) {
          konamiIndex += 1;
          if (konamiIndex === konami.length) {
            konamiIndex = 0;
            unlockSecret("konami", "Konami Cat awakened.");
          }
        } else {
          konamiIndex = key.toLowerCase() === konami[0].toLowerCase() ? 1 : 0;
        }
      });

      render();
      setLaserReadout(0, 5);
      console.log("Gallery of Meow v2 loaded.");
    })();
  </script>
</body>

</html>
